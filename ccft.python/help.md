# Network analyzer (Network Analyzer-H, NaH)

## foundation

`NaH, as the backend program of CCFTool(), is responsible for network construction and analysis functions.

### term

- Source code set

  > The source code set is represented as a collection of code files, which is a folder containing all the source code files to be analyzed.

- Graph Analysis Model Level

  > The graph parsing model level is a collection of graph parsing models, as one source code set can generate multiple graph parsing models, which provide different perspectives and facilitate analysis. The graph parsing model uses folder storage, which means that a graph parsing model folder contains multiple files describing the objects of the graph parsing model. Therefore, the graph parsing model level is a folder that contains the graph parsing model folder.

  - Graph Analysis Model

    > The basis of the graph parsing model is a ` networkx MultiDiGraph 'graph object contains multiple files for describing graph parsing model objects, including
    >
    > - `nodes.csv`：Storage node information file；
    > - `edge.csv`：Store edge information files；
    > - `graph.bin`：Store graph model binary files；
    > - `graph.gexf`：Gephi readable graph model files。

- Graph analysis model level

### firing

`NaH`Start using the command line, and the program address must be attached as a parameter, otherwise it cannot be started.

### data type

#### <a id='node-type'>Node Type</a>

|       Type       | identify |
|:----------------:|:--------:|
|      Nan，empty       |    0     |
|    Method，function     |    1     |
|    Local，global variable    |    2     |
|    Member，attribute     |    3     |
| TypeDecl，Custom Data Structure |    4     |
|     File，file      |    5     |

#### <a id='relation-type'>relationship type</a>

|         Type          | identify |
| :-------------------: | :--: |
|        Nan，empty        |  0   |
|   Contain，Include relationships   |  1   |
| Call，Zero scale dependency relationship  |  2   |
|  Data，Data dependency relationship   |  3   |
| Control，Control dependency relationships |  4   |

#### <a id='expand-val'>Expansion direction</a>

|            Type             | identify |
| :-------------------------: | :--: |
| Predecessor，Expand to Forward Drive Nodes |  1   |
|  Successor，Extend to successor nodes  |  2   |
|       Dual，Bi directional expansion        |  3   |

### communication

`NaH 'runs the program in the background without a visual interface. Communication with the outside world is carried out using' tcp 'and is on the' tcp server 'port. The configuration file is' config. json' in the program file. By default, 'ip=' 127.0.0.1 'prot=8192'.

### command format

Provide two communication command formats, ` text ` and ` json ` format. The default is ` json ` format, which can describe complex data types. ` text ` format is generally used for experimentation and debugging.

#### Receive command format

The format for receiving commands is as follows, where 'type' is the type of the command, 'id' is the identifier of the command used to verify the instruction receipt, and 'arguments' are the parameters attached to the command.

```json
{
  "type": "action",
  "id": 0,
  "arguments": {
    "arg1": "value1",
    "arg2": "value2"
  }
}
```

#### Send command format

The format of sending commands is as follows, where 'type' is the 'recv' indicating that the command is a reply command, 'id' is the identifier of the reply command, 'status' indicates the execution result of the reply command, is of type' boolean ', and' message 'is the additional content of the reply command.

```json
{
  "type": "recv",
  "id": 0,
  "status": true, 
  "message": "message to say"
}
```



## API

### Analysis function

#### parse-source-code：Generate CPG from source code set

> Use 'joern-cli' to parse the source code set, generate the 'CPG' file of the source code set, and export it in the 'Neo4jcsv' format.

##### parameter

**src**

> Source code folder directory

`Type: str, Necessity: Necessary`

**output**

> Output folder directory, set to the image model level address by default, automatically generates' cpg. bin '(CPG file) and'. cpg '(CPG folder, exported in Neo4jcsv format) under the output folder directory.

`Type: str, Necessity: Necessary`

##### example

```json
{
  "type": "parse-source-code",
  "id": 0,
  "arguments": {
      "src": "source directory",
      "output": "Output directory address"
  }
}
```

#### parse-cpg：Generate Graph Analysis Model Level from CPG

> The program parses the CPG file and generates a graph parsing model level, which is a collection of graph parsing models generated by the code. By default, two graph parsing models, 'basic' and 'topic', are generated from the CPG file. among
>
> 1. `Basic is a graph parsing model that contains all the information;
> 2. `Topic is a graph parsing model that only contains information about functions, variables, and attribute nodes.
>
> The address of the graph parsing model level is the 'parse model dir' folder. In addition, both 'basic' and 'topic' are generated based on the same source code set and are placed in the graph parsing model level folder.
>
> Each graph parsing model is represented by a folder, which includes the file node information file 'nodes. csv', edge information file 'edge. csv', graph model binary file 'graph. bin', Gephi readable graph model file 'graph. gexf', and image file 'graph. png'.

##### parameter

**parse-model-dir**

> The model level address for graph parsing is usually the parameter 'output' in 'parse source code'.

`Type: str, Necessity: Necessary`

**neo4j**

> `The folder address of the Neo4jcsv file defaults to $(parse model dir)/. cpg.

`Type: str, Necessity: Non necessary`

##### Command Instance

```json
{
  "type": "parse-cpg",
  "id": 0,
  "arguments": {
      "parse-model-dir": "Graph parsing model level address",
      "neo4j": ".neo4jcsv directory"
  }
}
```

-----------

### Loading function

#### load-model：Load graph parsing model level file

> Specify the graph parsing model level address and read all graph parsing models under the graph parsing model level.

##### **parameter**

**model-dir**

> Map model address.

`Type: str, Necessity: Necessary`

**from**

> The type of graph model to load can be selected from 1 parsing level model: 'parse', and 2 analysis level models: 'analysis'.

`Type: str, Necessity: Necessary`

##### Command Instance

```json
{
  "type": "load-model",
  "id": 0,
  "arguments": {
      "model-dir": "Graph model level address",
      "from": "parse"
  }
}
```

-------

### Crop function

#### cut-parse-model：Graph segmentation generates analytical level models

> Specify the benchmark graph parsing model, crop and generate a new (smaller) graph parsing model.

##### parameter

**base**

> The name of the benchmark graph analysis model.

`Type: str, Necessity: Necessary`

**name**

> The name of the generated new graph parsing model.

`Type: str, Necessity: Necessary`

**start-nodes**

> The initial set of nodes is empty by default.

`Type: list [int] `, ` Necessity: Non necessary`

**node-types**

> Reference [Node Type] (# node type), set of node types, default to ` [Method, Local, Member] `, i.e. ` [1,2,3] `.

`Type: ENode, Necessity: Non essential`

**relations**

> Reference [relationship type], set of edge types, default to ` [Call, Data, Control] `, i.e. ` [2,3,4] `.

`Type: ERelation, Necessity: Non necessary`

**direction**

> Reference [Expansion Direction](#expand-val)，The default direction for node expansion is' Predecessor (1) '.

`Type: EExpand, Necessity: Non necessary`

##### Command Instance

```json
{
  "type": "cut-parse-model",
  "id": 0,
  "arguments": {
      "base": "base sub-parse-model name",
      "name": "gen sub-parse-model name",
      "start-nodes": [],
      "node-types": [1,2,3],
      "relations": [2,3,4],
      "direction": 1
  }
}
```

### Graph generation function

#### gen-analysis-model：Generate Graph Analysis Model

> Specify the graph analysis model, convert the polygon graph into a one-sided graph, and generate a graph analysis model.

##### parameter

**parse-model-name**

> The name of the specified graph parsing model.

`Type: str, Necessity: Necessary`

**directory**

> The address of the generated graph analysis model.

`Type: str, Necessity: Necessary`

**control**

> Specify control dependency weights, default to 0.

`Type: float, necessity: non necessary`

**data**

> Specify the data dependency weight, which defaults to 0.2.

`Type: float, necessity: non necessary`

**zero**

> Specify zero scale dependency weights, default to 0.1.

`Type: float, necessity: non necessary`

**repeat**

> Whether the dependency relationship accumulates, defaults to True.

`Type: boolean, Necessity: Non necessary`

##### Command Instance

```json
{
  "type": "gen-analysis-model",
  "id": 0,
  "arguments": {
      "parse-model-name": "base parse-model name",
      "directory": "gen analysis-model name",
      "control": 0.5,
      "data": 0.2,
      "zero": 0.1,
      "repeat": true
  }
}
```

----

### Graph analysis function

#### get-path：Route

> Specify the starting and ending nodes to analyze the path.

##### parameter

**from**

> The type of graph model to load can be selected from 1 parsing level model: 'parse', and 2 analysis level models: 'analysis'.

`Type: str, Necessity: Necessary`

**base-graph**

> The name of the baseline model.

`Type: str, Necessity: Necessary`

**start**

> Starting node.

`Type: int `, ` Necessity: Necessary`

**end**

> Terminate the node.

`Type: int `, ` Necessity: Necessary`

**max-len**

> The maximum length of a path, default to -1, indicates no limit.

`Type: int `, ` Necessity: Non necessary`

**tag**

> Path search method, optional: 1. Shortest path: 'short', 2. All paths: 'all', default is' all '.

`Type: str, Necessity: Non necessary`

##### return value



##### Command Instance

```json
{
  "type": "get-path",
  "id": 0,
  "arguments": {
      "from": "analysis",
      "base-graph": "base graph name",
      "start": 0,
      "end": 1,
      "max-len": -1,
      "tag": "all"
  }
}
```

#### get-tree：Subtree Search

> Specify the starting and ending nodes to analyze the path.

##### parameter

**from**

> The type of graph model to load can be selected from 1 parsing level model: 'parse', and 2 analysis level models: 'analysis'.

`Type: str, Necessity: Necessary`

**base-graph**

> The name of the baseline model.

`Type: str, Necessity: Necessary`

**root**

> Root node.

`Type: int `, ` Necessity: Necessary`

**direction**

> Reference [Expansion Direction](#expand-val)，The default direction for node expansion is' Predecessor (1) '.

`Type: EExpand, Necessity: Non necessary`

**max-dep**

> The maximum depth limit is set to -1 by default, indicating no limit.

`Type: int `, ` Necessity: Non necessary`

##### return value



##### Command Instance

```json
{
  "type": "get-tree",
  "id": 0,
  "arguments": {
      "from": "analysis",
      "base-graph": "base graph name",
      "root": 0,
      "direction": 1,
      "max-dep": -1
  }
}
```

